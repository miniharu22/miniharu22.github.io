---
layout : single
title: "[CNN] Image Reshaping & Cleaning"
categories: 
  - Wafer Map Defect Detection
toc: true
toc_sticky: true
use_math: true
---


## 0. Image Reshaping   
### 0-1. Check Image shape   

```python 

for i in range(len(failure_types)):
  b = 0
  for j in [0,1]:
    if i != 0:
      b=1
    plt.subplot(3,6,(2*i+1)+j)
    plt.imshow(data_labelled['waferMap'][data_labelled['failureType']==failure_types[i]].iloc[j])
    plt.title(failure_types[i])
    plt.xticks([])
    plt.yticks([])

plt.tight_layout()
```

<div align="left">
  <strong>출력 결과</strong>
  <img src="/assets/images/WM/24.png" width="100%" height="100%" alt=""/>
  <p><em></em></p>
</div>
{: .notice}

- 위 plot을 보면, 클래스 별로 이미지의 size/shape가 조금씩 다른 것을 알 수 있음    
- Neural Network를 활용하기 위해서는 모든 data의 규격이 동일해야하므로 이를 위해서는 shape를 일정하게 맞춰줄 필요가 있음    

&nbsp;

### 0-2. Dataframe with Image Shape   

```python
shapes = pd.unique(data_labelled['waferMap'].map(lambda x: x.shape))
print(shapes.shape)

data_labelled['shape'] = data_labelled['waferMap'].map(lambda x: x.shape)

data_labelled.head()
```

<div align="left">
  <strong>출력 결과</strong><br>  
   (346,)
  <img src="/assets/images/WM/25.png" width="100%" height="100%" alt=""/>
  <p><em></em></p>
</div>
{: .notice}

- 모든 이미지에 대해 shape의 고유값을 확인하면 총 346개의 종류가 존재하는 것을 알 수 있음    
- 전처리를 위헤 Dataframe에 각 Wafer 별로 shape를 추가함    

&nbsp;

### 0-3. Median Shape of Images   

```python
import numpy as np

shape_image_number = list()
for shape in shapes:
  shape_image_number.append(
      (shape,np.sum([data_labelled['shape']==shape]))
  )

median_first_dimension =  np.median(list(map(lambda x: x[0][0], shape_image_number)))
median_second_dimension = np.median(list(map(lambda x: x[0][1], shape_image_number)))

median_shape = (int(median_first_dimension), int(median_second_dimension))

print('median first dim.', 'median second dim.')
print(median_first_dimension, '            ', median_second_dimension)
```

**출력 결과**   
median first dim. median second dim.   
53.0              52.0   
{: .notice}

- 